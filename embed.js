!function(e,t,s){function a(){return o.short_name?f+"//"+o.short_name+"."+T.DOMAIN:T.REMOTE}function i(){function t(){for(var t,a,i;t=v.shift();){a=t.url,i=new s(t.title,{dir:"auto",icon:t.iconUrl,body:t.body});try{i.onclick=function(){e.focus(),c.href=a,i.close()}}catch(e){}setTimeout(function(){i.close&&i.close()},8e3)}}var s=e.Notification;"Notification"in e&&"denied"!==s.permission&&("granted"===s.permission&&t(),s.requestPermission(function(e){"granted"===e&&t()}))}function r(){return 0==ie.data.user_id}function n(e){T.theme=e,"none"!=e&&le.injectStylesheet(T.STATIC_URL+"/styles/embed"+(e?"."+e+".css?"+R[e]:"."+short_name)+".css")}var o,d,l,c,u,p,h,f,m,v,g,b,y,_,w,k,x,T,C,S,q,P,O,E,L,N,I,R,A,M,U,D,z,W,B,H,J,V,Q,$,F,G,Y,Z,X,K,ee,te,se,ae,ie,re,ne,oe,de,le={},ce=t.getElementsByTagName("head")[0]||t.getElementsByTagName("body")[0];if(le.extend=function(e,t){for(var s in t)e[s]=t[s];return e},le.injectScript=function(a,i){var r=t.createElement("script"),n=t.head||t.getElementsByTagName("head")[0]||t.documentElement;r.type="text/javascript",r.src=a,r.async="async",r.charset="utf-8",i&&(r.onload=r.onreadystatechange=function(t,a){var o=a||!r.readyState||/loaded|complete/.test(r.readyState);o&&(r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r),r=s,a||i.call(e))}),n.insertBefore(r,n.firstChild)},le.injectStylesheet=function(e){var s=t.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,ce.appendChild(s)},le.injectStyle=function(e){var s=t.createElement("style");return s.type="text/css",ce.appendChild(s),e=e.replace(/\}/g,"}\n"),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),s},le.getCookie=function(e){for(var a,i,r,n=" "+e+"=",o=t.cookie.split(";"),d=0;d<o.length;d++)if(a=" "+o[d],i=a.indexOf(n),i>=0&&i+n.length==(r=a.indexOf("=")+1))return decodeURIComponent(a.substring(r,a.length).replace(/\+/g,""));return s},le.param=function(e){var t,a=[];for(t in e)e[t]!=s&&a.push(t+"="+encodeURIComponent(e[t]));return a.join("&")},le.cssProperty=function(e,s){var a,i,r=(t.body||t.documentElement).style;if("undefined"==typeof r)return!1;if("string"==typeof r[e])return!s||e;for(a=["Moz","Webkit","ms"],e=e.charAt(0).toUpperCase()+e.substr(1),i=0;i<a.length;i++)if("string"==typeof r[a[i]+e])return!s||a[i]+e},!e.DUOSHUO){for(j in Object.prototype)return alert("err67");l=e.JSON,c=e.location,u=e.XMLHttpRequest,p=l&&l.stringify&&e.localStorage,h=e.navigator.userAgent,f="https:"==t.location.protocol?"https:":"http:",m=0,v=[],g=d=function(){function e(e){return t[e]||"&amp;"}var t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},s=/&(?!\w+;)|[<>"'`]/g,a=/[&<>"'`]/;return function(t){return null==t||t===!1?"":a.test(t)?t.replace(s,e):t}}(),b=function(e){if(e.match(/^(http|https):/))return e;var s=t.createElement("a");return s.href=e,S.hrefNormalized?s.href:s.getAttribute("href",4)},y=function(e){return function(){return e}},_=function(){var e,t,s;for(e={},t=0;t<arguments.length;t++)arguments[t]&&le.extend(e,arguments[t]);return s=le.param(e),s?"?"+s:""},w=function(){var e=le.getCookie("duoshuo_token");return e?{jwt:e}:o.remote_auth?{short_name:o.short_name,remote_auth:o.remote_auth}:s},k=function(){if(!o&&(o=e.duoshuoQuery)){if(!o.short_name||"your_duoshuo_short_name"===o.short_name)return o=s,void alert("未设置多说域名(duoshuoQuery.short_name)，填入已有域名或创建新站点：http://duoshuo.com/create-site/");se.trigger("queryDefined")}return o},x=function(e){return e&&e.error&&e.warn?e:{error:function(){},log:function(){},warn:function(){}}}(e.console),T=e.DUOSHUO={sourceName:{weibo:"新浪微博",qq:"QQ",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},serviceNames:{weibo:"微博",qq:"QQ",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},parseDate:function(e){return e.parse("2011-10-28T00:00:00+08:00")&&function(t){return new e(t)}||e.parse("2011/10/28T00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||e.parse("2011/10/28 00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(t){return new e(t)}}(Date),fullTime:function(e){var t=T.parseDate(e);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.toLocaleTimeString()},elapsedTime:function(e){var t=T.parseDate(e),s=new Date,a=(s-m-t)/1e3;return 10>a?"刚刚":60>a?Math.round(a)+"秒前":3600>a?Math.round(a/60)+"分钟前":86400>a?Math.round(a/3600)+"小时前":(s.getFullYear()==t.getFullYear()?"":t.getFullYear()+"年")+(t.getMonth()+1)+"月"+t.getDate()+"日"},compileStyle:function(e){var t,s="",a={};if(a.textbox="#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper",!e)return s;for(t in e)s+=a[t]+"{"+e[t]+"}\n";return s},init:function(e,t){e&&!q[e]&&(q[e]=t||{type:"EmbedThread"}),T.initView&&T.initView()}},C=t.all,S=T.support=function(){var s,a,i,r=t.createElement("div");return r.innerHTML='<a href="/a" style="opacity:.55;">a</a><input type="checkbox"/>',s=r.getElementsByTagName("a")[0],a=r.getElementsByTagName("input")[0],i={placeholder:"placeholder"in a,touch:"ontouchstart"in e||"onmsgesturechange"in e,opacity:/^0.55$/.test(s.style.opacity),hrefNormalized:"/a"===s.getAttribute("href"),iOS:h.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:h.match(/ \(Linux; U; Android /)},i.ie6=!u&&"undefined"==typeof r.style.maxHeight,i.authInWin=e.postMessage&&e.screen.width>800&&!i.iOS&&!i.android&&c.origin,i}(),q=T.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"},".ds-share":{type:"ShareWidget"}},P=T.openDialog=function(e){return T.dialog!==s&&T.dialog.el.remove(),T.dialog=new ee.Dialog(X.dialog(e)).open()},O=T.smilies={},T.require=function(){function t(e){var t=A[e]?"?"+A[e]+".js":"";return T.STATIC_URL+"/libs/"+e+".js"+t}var s={mzadxN:"undefined"!=typeof mzadxN};return"undefined"!=typeof jQuery&&jQuery.fn.jquery>="1.5"&&(s["embed.compat"]=!0,T.jQuery=e.jQuery),function(e,a){if("string"==typeof e)s[e]?a():le.injectScript(t(e),function(){s[e]=!0,a()});else if("object"==typeof e){var i,r=!0;for(i=0;i<e.length;i++)!function(n){s[e[i]]||(r=!1,le.injectScript(t(n),function(){s[n]=!0;for(var t=0;t<e.length;t++)if(!s[e[t]])return;a()}))}(e[i]);r&&a()}}}();for(E=0,L=["EmbedThread","RecentComments","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"];E<L.length;E++)T[L[E]]=function(e){return function(t,s){s=s||{},s.type=e,t&&!q[t]&&(q[t]=s),T.initSelector&&T.initSelector(t,s)}}(L[E]),T["create"+L[E]]=function(e){return function(s,a){var i,r=t.createElement(s);for(i in a)r.setAttribute("data-"+i,a[i]);return T[e](r),r}}(L[E]);T.RecentCommentsWidget=T.RecentComments,N=T.API={ajax:function(e,t,i,r,n){function d(e){var t=e.getResponseHeader("Date");t&&(m=new Date-new Date(t))}function c(e,t,s){var a,i,o,c=t;if(e>=200&&300>e||304===e)if(304===e)c="notmodified",o=!0;else try{a=l.parse(s),c="success",o=!0}catch(e){c="parsererror",i=e}else{i=c,(!c||e)&&(c="error",0>e&&(e=0));try{a=l.parse(s)}catch(e){c="parsererror",i=e}}o?r&&r(a):"parseerror"===c?x.error("解析错误: "+s):(x.error("出错啦("+a.code+"): "+a.errorMessage),n&&n(a),a.errorTrace&&x.error(a.errorTrace)),d(h)}var p,h,f,v,g,b=le.getCookie("duoshuo_token");return i=i||{},i.v=T.version,b?i.jwt=b:o.remote_auth&&(i.remote_auth=o.remote_auth),p=u&&l&&l.parse,p&&(h=new u,f=!!h&&"withCredentials"in h)?(h.open(e,a()+"/api/"+t+".json"+("GET"==e?"?"+le.param(i):""),!0),h.withCredentials=!0,h.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),h.send("GET"==e?null:le.param(i)),v=function(e,t){var a,i,r,n;try{if(v&&(t||4===h.readyState))if(v=s,t)4!==h.readyState&&h.abort();else{a=h.status,r=h.getAllResponseHeaders();try{n=h.responseText}catch(e){}try{i=h.statusText}catch(e){i=""}}}catch(e){t||c(-1,e)}n&&c(a,i,n,r)},void(4===h.readyState?v():h.onreadystatechange=v)):("GET"!=e&&(i._method="POST"),g="cb_"+Math.round(1e6*Math.random()),N[g]=function(e){switch(e.code){case 0:r&&r(e);break;default:n&&n(e),x.error("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&x.error(e.errorTrace)}},i.callback="DUOSHUO.API['"+g+"']",void le.injectScript(a()+"/api/"+t+".jsonp?"+le.param(i)))},get:function(e,t,s,a){return this.ajax("GET",e,t,s,a)},post:function(e,t,s,a){return this.ajax("POST",e,t,s,a)}},I=T.ws={messages:[],send:function(s){var a,r,n;return!!("WebSocket"in e&&l)&&(a=this,a.messages.push(l.stringify(s)),a.webSocket||(r="https:"===t.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/",n=a.webSocket=new WebSocket(r),n.onopen=function(){var e,t=1===n.readyState;if(t)for(;e=a.messages.shift();)n.send(e)},n.onmessage=function(e){var t,s,a;try{t=l.parse(e.data)}catch(e){return}switch(t.type){case"post":for(a=0;a<T.pagelets.length;a++)s=T.pagelets[a],s.threadId==t.thread_id&&s.onMessage(t);break;case"notification":v.push(t),i()}},e.addEventListener("beforeunload",function(){n.close()})),void a.webSocket.onopen())}},T.DOMAIN="duoshuo.com",T.STATIC_URL=f+"//static.duoshuo.com",T.REMOTE=f+"//duoshuo.com",T.version="16.6.16",R={default:"9b2a46a0",dark:"33f3a5ac",bluebox:"39a75d50",newhua:"706ba4eb",justflat:"9d72ec5a"},A={"embed.compat":"24f8ca3f",smilies:"921e8eda"},M={post:"发布",posting:"正在发布",settings:"设置",reply:"回复",like:"顶",repost:"转发",report:"举报",delete:"删除",reply_to:"回复 ",reposts:"转发",comments:"评论",floor:"楼",latest:"最新",earliest:"最早",hottest:"最热",share_to:"分享到:",leave_a_message:"",no_comments_yet:"没有评论",repost_reason:"请输入转发理由",hot_posts_title:"被顶起来的评论",comments_zero:"暂无评论",comments_one:"1条评论",comments_multiple:"{num}条评论",reposts_zero:"暂无转发",reposts_one:"1条转发",reposts_multiple:"{num}条转发",weibo_reposts_zero:"暂无新浪微博",weibo_reposts_one:"1条新浪微博",weibo_reposts_multiple:"{num}条新浪微博"},U={get:function(e){return p?p[e]:void 0},save:function(e,t){if(p)try{p.removeItem(e),p[e]=l.stringify(t),p.removeItem(e+":timestamp"),p[e+":timestamp"]=Math.floor((new Date-m)/1e3)}catch(e){}}},D=T.loadRequire=function(t){var s;if(t.visitor&&(!ie.data&&t.visitor.user_id&&e.Notification&&I.send({logged_user_id:t.visitor.user_id}),ie.reset(t.visitor)),t.site&&(ae.reset(t.site),U.save("ds_site_"+o.short_name,t.site)),!T.theme&&ae.data.theme&&n(ae.data.theme),t.lang&&(le.extend(M,t.lang),U.save("ds_lang_"+o.short_name,t.lang)),t.stylesheets)for(s=0;s<t.stylesheets.length;s++)le.injectStylesheet(t.stylesheets[s]);if(t.nonce&&(T.nonce=t.nonce),t.style&&le.injectStyle((t.style||"")+T.compileStyle(o.component_style)),t.unread&&re.reset(t.unread),t.warnings)for(s=0;s<t.warnings.length;s++)x.warn(t.warnings[s])},z=0,W=T.Class=function(){},W.extend=function(e){function t(){!z&&this.init&&this.init.apply(this,arguments)}var s,a;z=1,s=new this,z=0;for(a in e)s[a]=e[a];return t.prototype=s,t.prototype.constructor=t,t.extend=arguments.callee,t},B=T.Event=W.extend({on:function(e,t){var a=this.handlers||(this.handlers={});return a[e]===s&&(a[e]=[]),a[e].push(t),this},trigger:function(e,t){var s,a=(this.handlers||(this.handlers={}))[e];if(a)for(s=0;s<a.length&&a[s].call(this,t)!==!1;s++);return this}}),H=T.Widget=B.extend({init:function(e,t){this.el=e,this.options=t||{},this.render()},render:function(){},reset:function(){},load:function(e){switch(e.code){case 0:D(e);var t=this.prepare(e);t.options=le.extend(this.options,e.options),this.onload(t);break;default:this.onError(e)}},onload:function(e){this.el.html(X[this.tmpl](e))},prepare:function(e){return e},onMessage:function(){},onError:function(e){x.error("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&x.error(e.errorTrace)}}),J=T.Model=B.extend({init:function(e){this.data=e},reset:function(e){this.data=e,this.trigger("reset")},remove:function(e){this.data.splice(e,1),this.trigger("reset")},set:function(e,t){if(t===s)for(var a in e)this.data[a]=e[a];else this.data[e]=t;return this.trigger("reset"),this},toJSON:function(){return le.extend({},this.data)}}),V=J.extend({toJSON:function(){return le.extend({},this.data)}}),Q=J.extend({toJSON:function(){var e=le.extend({},this.data);return e.theAuthor=de[this.data.author_id]&&de[this.data.author_id].data||this.data.author,e.parents=this.data.parents||[],e}}),$=J.extend({toJSON:function(){return le.extend({},this.data)}}),F=function(e){this.model=e},F.prototype.set=function(e){for(var t in e)e[t]&&(this[t]?this[t].set(e[t]):this[t]=new this.model(e[t]))},F.prototype.get=function(e){for(var t=0,s=[];t<e.length;t++)s[t]=this[e[t]];return s},F.prototype.getJSON=function(e){for(var t=0,s=[];t<e.length;t++)this[e[t]]&&s.push(this[e[t]].toJSON());return s},G={userUrl:function(e){return e.url},avatarUrl:function(e){return((e.avatar_url||ae.data.default_avatar_url)+"").replace(/^http:/,location.protocol)},loginUrl:function(e,t){return t||(t={}),o.sso&&o.sso.login&&(t.sso=1,t.redirect_uri=o.sso.login),a()+"/login/"+e+"/"+_(t)},bindUrl:function(e){return a()+"/bind/"+e+"/"+_(o.sso&&o.sso.login?{sso:1,redirect_uri:o.sso.login}:null,w())},logoutUrl:function(){return a()+"/logout/"+_(o.sso&&o.sso.logout?{sso:1,redirect_uri:o.sso.logout}:null)}},Y=["weixin","weibo","qq"],Z=["google"],X=T.templates={userAnchor:function(e){return e.url?'<a rel="nofollow author" target="_blank" href="'+g(e.url)+'">'+g(e.name)+"</a>":g(e.name)},avatarImg:function(e,t){return'<img src="'+g(G.avatarUrl(e,t))+'" alt="'+g(e.name)+'"'+(t?' style="width:'+t+"px;height:"+t+'px"':"")+"/>"},avatar:function(e,t){var s=X.avatarImg(e,t),i=G.userUrl(e);return i?'<a rel="nofollow author" target="_blank" href="'+g(i)+'" '+(e.user_id?" onclick=\"this.href='"+a()+"/user-url/?user_id="+e.user_id+"';\"":"")+' title="'+g(e.name)+'">'+s+"</a>":s},timeText:function(e){return e?'<span class="ds-time" datetime="'+e+'" title="'+T.fullTime(e)+'">'+T.elapsedTime(e)+"</span>":""},timeAnchor:function(e,t){return e?'<a href="'+t+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+e+'" title="'+T.fullTime(e)+'">'+T.elapsedTime(e)+"</a>":""},serviceIcon:function(e,t){return'<a href="javascript:void(0)" class="ds-service-icon'+(t?"-grey":"")+" ds-"+e+'" data-service="'+e+'" title="'+T.sourceName[e]+'"></a>'},poweredBy:function(e){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+g(e)+"</a></p>"},indicator:y('<div id="ds-indicator"></div>'),waitingImg:y('<div id="ds-waiting"></div>'),loginItem:function(e,t){var s=G[t?"bindUrl":"loginUrl"](e);return'<li>    <a href="'+s+'" rel="nofollow" class="ds-service-link ds-'+e+'">'+T.serviceNames[e]+(ie.data.social_uid[e]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a></li>"}},K=function(e){var t,s=[];for(t in e)s.push('<input type="hidden" name="'+t+'" value="'+g(e[t])+'" />');return s.join("\n")},X.commentList=function(e){var t,s,a,i="",r=e.list;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+='<li class="ds-comment',e.options.show_avatars&&(i+=" ds-show-avatars"),i+='" data-post-id="'+t.post_id+'">',e.options.show_avatars&&(i+='<div class="ds-avatar">'+X.avatar(t.theAuthor,e.options.avatar_size)+"</div>"),i+='<div class="ds-meta">'+X.userAnchor(t.theAuthor),e.options.show_time&&(i+=X.timeText(t.created_at)),i+="</div>",i+=e.options.show_title?'<div class="ds-thread-title">在 <a href="'+d(t.thread.url)+'#comments">'+d(t.thread.title)+'</a> 中评论</div><div class="ds-excerpt">'+t.message+"</div>":'<a class="ds-excerpt" title="'+t.thread.title+' 中的评论" href="'+d(t.thread.url)+'#comments">'+t.message+"</a>",i+="</li>";return i},X.ctxPost=function(e){var t="";return e.post&&(t+='<li class="ds-ctx-entry"',e.hidden&&(t+=' style="display:none"'),t+=' data-post-id="'+e.post.post_id+'"><div class="ds-avatar">'+X.avatar(e.post.theAuthor||e.post.author)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+X.userAnchor(e.post.theAuthor||e.post.author)+X.timeAnchor(e.post.created_at,e.post.url),e.index>=0&&(t+='<div class="ds-ctx-nth" title="'+T.fullTime(e.post.created_at)+'">'+(e.index+1)+M.floor+"</div>"),t+='</div><div class="ds-ctx-content">'+e.post.message,e.index>=0&&(t+='　　　　　　　<div class="ds-comment-actions',e.post.vote>0&&(t+=" ds-post-liked"),t+='">'+X.likePost(e.post)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+M.repost+'</a><a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+M.reply+"</a></div>"),t+="</div></div></li>"),t},X["dialog-anonymous"]=function(e){var t,s,a,i='<h2>社交帐号登录</h2><div class="ds-icons-32">',r=e.services;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+='<a class="ds-'+t+'" href="'+G.loginUrl(t)+'">'+T.sourceName[t]+"</a>";return i+="</div>",e.options.deny_anonymous||(i+='<h2>作为游客留言</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+d(ie.data.name)+'" required /><label for="ds-dialog-name">名字(必填)</label></div>',e.options.require_guest_email&&(i+='<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+d(ie.data.email)+'" required /><label for="ds-dialog-email">邮箱(必填)</label></div>'),e.options.require_guest_url&&(i+='<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+d(ie.data.url)+'" /><label for="ds-dialog-url">网址(可选)</label></div>'),i+='<button type="submit">发布</button></form>'),i},X["dialog-ask-for-auth"]=function(){var e='<h2>社交帐号登录</h2><ul class="ds-service-list">'+X.serviceList(Y)+'</ul><ul class="ds-service-list ds-additional-services">'+X.serviceList(Z)+"</ul>";return e},X["dialog-bind-more"]=function(){var e='<h2>绑定更多帐号</h2><ul class="ds-service-list">'+X.serviceBindList(Y)+'</ul><ul class="ds-service-list ds-additional-services">'+X.serviceBindList(Z)+'</ul><div style="clear:both"></div>';return e},X["dialog-qrcode"]=function(e){var t='<h2>分享到微信朋友圈</h2><div class="ds-share-qrcode" style="text-align:center;"><img src="'+e.qrcode_url+'" alt="'+e.url+'"></div>';return t},X["dialog-reposts"]=function(e){var t='<h2>转发到微博</h2><div class="ds-quote"><strong>@'+d(e.post.theAuthor.name)+"</strong>: "+e.post.message+"</div><form>"+K({post_id:e.post.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+d(M.repost_reason)+'">'+d(e.repostMessage)+'</textarea><pre class="ds-hidden-text"></pre>';return t+='</div><div class="ds-actions">',e.service?t+=K({"service[]":e.service}):(t+='<label><input type="checkbox" name="service[]" value="weibo"',ie.data.social_uid.weibo&&(t+=' checked="checked"'),t+=' /><span class="ds-service-icon ds-weibo"></span>新浪微博</label>'),t+='<button type="submit">'+M.repost+"</button></div></form>"},X.dialog=function(e){var t='<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+e+'</div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>社会化评论框</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="关闭"></a></div></div>';return t},X.hotPosts=function(e){var t,s,a,i='<div class="ds-header ds-gradient-bg">'+d(M.hot_posts_title)+"</div><ul>",r=e.list;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+=X.post({post:t,options:e.options});return i+="</ul>"},X.likePost=function(e){var t='<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>'+M.like;return e.likes>0&&(t+="("+e.likes+")"),t+="</a>"},X.likeTooltip=function(e){var t,s='<div class="ds-like-tooltip ds-rounded"><p>很高兴你能喜欢，分享一下吧：</p><ul>';for(t in e.services)s+='<li><a class="ds-share-to-'+t+" ds-service-link ds-"+t+'" href="'+a()+"/share-proxy/?"+le.param({service:t,thread_id:e.thread_id})+'">'+e.services[t]+"</a></li>";return s+='</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">算了</a></p></div>'},X.loginButtons=function(){var e='<div class="ds-login-buttons"><p>社交帐号登录:</p><div class="ds-social-links"><ul class="ds-service-list">'+X.serviceList(Y)+'<li><a class="ds-more-services" href="javascript:void(0)">更多»</a></li></ul><ul class="ds-service-list ds-additional-services">'+X.serviceList(Z)+"</ul></div></div>";return e},X.loginWidget=function(e){var t,s,a,i='<div class="ds-icons-32">',r=e;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+='<a class="ds-'+t+'" href="'+G.loginUrl(t)+'">'+T.sourceName[t]+"</a>";return i+="</div>"},X.meta=function(e){var t='<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded';return e.user_vote>0&&(t+=" ds-thread-liked"),t+='"><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">',t+=e.user_vote>0?"已喜欢":"喜欢",t+='</span><span class="ds-thread-cancel-like">取消喜欢</span></a><span class="ds-like-panel"></span></div>'},X.notify=function(e){var t='<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="多说"></a><ul class="ds-notify-unread"><li';return e.comments||(t+=' style="display:none;"'),t+='><a data-type="unread-comments" href="javascript:void(0);">你有'+e.comments+"条新回复</a></li><li",e.notifications||(t+=' style="display:none;"'),t+='><a data-type="unread-notifications" href="javascript:void(0);">你有'+e.notifications+"条系统消息</a></li></ul></div>"},X.post=function(e){var t,s,i,r,n,o,l="",c=e.post,u=e.options,p=c.author;if(l+='<li class="ds-post" data-post-id="'+c.post_id+'"><div class="ds-post-self" data-post-id="'+c.post_id+'" data-thread-id="'+c.thread_id+'" data-root-id="'+c.root_id+'" data-source="'+c.source+'"><div class="ds-avatar"',p.user_id&&(l+=' data-user-id="'+p.user_id+'"'),l+=">"+X.avatar(p),T.sourceName[c.source]&&(l+=X.serviceIcon(c.source)),l+='</div><div class="ds-comment-body"><div class="ds-comment-header">',p.url?(l+='<a class="ds-user-name ds-highlight" data-qqt-account="'+(p.qqt_account||"")+'" href="'+d(p.url)+'" ',p.user_id&&(l+=" onclick=\"this.href='"+a()+"/user-url/?user_id="+p.user_id+"';\""),l+=' rel="nofollow" target="_blank"',p.user_id&&(l+=' data-user-id="'+p.user_id+'"'),l+=">"+d(p.name)+"</a>"):(l+='<span class="ds-user-name"',p.user_id&&(l+=' data-user-id="'+p.user_id+'"'),l+=' data-qqt-account="'+(p.qqt_account||"")+'">'+d(p.name)+"</span>"),l+="</div>",1==u.max_depth&&u.show_context&&c.parents.length){if(l+='<ol id="ds-ctx">',t=oe.getJSON(c.parents))for(i=-1,r=t.length-1;r>i;)s=t[i+=1],1==i&&c.parents.length>2&&(l+='<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">还有'+(c.parents.length-2)+"条评论</a></li>"),l+=X.ctxPost({post:s,index:i,hidden:i&&i<c.parents.length-1});l+="</ol>"}if(l+="<p>",c.parents.length>=u.max_depth&&(!u.show_context||u.max_depth>1)&&c.parent_id&&oe[c.parent_id]&&(l+='<a class="ds-comment-context" data-post-id="'+c.post_id+'" data-parent-id="'+c.parent_id+'">'+M.reply_to+d(oe[c.parent_id].toJSON().author.name)+": </a>"),l+=c.message+'</p><div class="ds-comment-footer ds-comment-actions',c.vote>0&&(l+=" ds-post-liked"),l+='">',l+=c.url?X.timeAnchor(c.created_at,c.url):X.timeText(c.created_at),"duoshuo"==c.source?(l+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+M.reply+"</a>"+X.likePost(c)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+M.repost+'</a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>'+M.report+"</a>",c.privileges.delete&&(l+='<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"></span>'+M.delete+"</a>")):("qqt"==c.source||"weibo"==c.source)&&(l+='<a class="ds-weibo-comments" href="javascript:void(0);">'+M.comments,c.type.match(/\-comment$/)||(l+='(<span class="ds-count">'+c.comments+"</span>)"),l+='</a><a class="ds-weibo-reposts" href="javascript:void(0);">'+M.reposts,c.type.match(/\-comment$/)||(l+='(<span class="ds-count">'+c.reposts+"</span>)"),l+="</a>"),l+="</div></div></div>",u.max_depth>1&&(c.childrenArray||c.children)&&"weibo"!=c.source&&"qqt"!=c.source){if(l+='<ul class="ds-children">',n=oe.getJSON(c.childrenArray||c.children))for(i=-1,o=n.length-1;o>i;)c=n[i+=1],l+=X.post({post:c,options:u});l+="</ul>"}return l+="</li>"},X.postListHead=function(e){var t='<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+M.latest+'</a><a class="ds-order-asc">'+M.earliest+'</a><a class="ds-order-hot">'+M.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"></a></li>';return e.options.show_reposts&&e.thread.reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"></a></li>'),t+=" ",e.options.show_weibo&&e.thread.weibo_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"></a></li>'),t+=" ",e.options.show_qqt&&e.thread.qqt_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"></a></li>'),t+="</ul></div>"},X.recentVisitors=function(e){var t,s,a,i="",r=e.response;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+='<div class="ds-avatar">'+X.avatar(t,e.options.avatar_size)+"</div>";return i},X["related-read"]=function(e){var t,s,a,i,r,n,o,d,l="";if(e&&e.length){if(l+='<article class="ds-reads-expand"><div class="ds-header">头条推荐</div><section> ',t=e)for(a=-1,i=t.length-1;i>a;){if(s=t[a+=1],l+=' <a href="'+s.url+'" class="ds-reads-item"> ',3==s.imgs.length){if(l+=" <h2>"+s.title+'</h2> <div class="ds-reads-pics"> <ul> ',r=s.imgs)for(o=-1,d=r.length-1;d>o;)n=r[o+=1],l+=' <li> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+n+');"></div> </li> ';l+=' </ul> </div> <div class="ds-reads-info"> ',1==s.type&&(l+=' <span class="ds-reads-app-special">打开头条阅读</span> '),l+=' <span class="ds-reads-date" data-date="'+s.timeStamp+'"></span> </div> '}else l+=' <div class="ds-reads-desc ',s.imgs.length||(l+="ds-reads-only"),l+='"> <div class="ds-reads-title">'+s.title+'</div> <div class="ds-reads-info"> ',1==s.type&&(l+=' <span class="ds-reads-app-special">打开头条阅读</span> '),l+=' <span class="ds-reads-date" data-date="'+s.timeStamp+'"></span> </div> </div> ',s.imgs.length&&(l+=' <div class="ds-reads-pic-right"> <div class="ds-reads-dumb"></div> <div class="ds-reads-pic-wrap" style="background-image:url('+s.imgs[0]+');"> ',s.hasVideo&&(l+=' <div class="ds-reads-vid-info"><span>'+s.videoDuration+"</span></div> "),l+=" </div> </div> "),l+=" ";l+=" </a> "}l+="</section></article>"}return l},X.replybox=function(e){var t,s='<div class="ds-replybox"><a class="ds-avatar"';if(s+=r()?' href="javascript:void(0);" onclick="return false"':' href="'+T.REMOTE+"/settings/avatar/"+_(w())+'" target="_blank" title="设置头像"',s+=">"+X.avatarImg(ie.data)+'</a><form method="post">'+K(e.params)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+d(M.leave_a_message)+'"></textarea><pre class="ds-hidden-text"></pre>',s+="</div>",s+='<div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">',!r()&&ie.data.repostOptions){s+='<input id="ds-sync-checkbox',e.inline&&(s+="-inline"),s+='" type="checkbox" name="repost" ',e.checked&&(s+='checked="checked" '),s+='value="'+e.repostArray.join(",")+'"> <label for="ds-sync-checkbox',e.inline&&(s+="-inline"),s+='">'+M.share_to+"</label>";for(t in ie.data.repostOptions)s+=X.serviceIcon(t,!ie.data.repostOptions[t])}return s+="</span>",s+="</div>",s+='<button class="ds-post-button" type="submit">'+d(M.post)+'</button><div class="ds-toolbar-buttons">',e.options.use_smilies&&(s+='<a class="ds-toolbar-button ds-add-emote" title="插入表情"></a>'),e.options.use_images&&e.options.parse_html_enabled&&(s+='<a class="ds-toolbar-button ds-add-image" title="插入图片"></a>'),s+="</div></div>",s+="</form></div>"},X.serviceBindList=function(e){var t,s,a,i="",r=e;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+='<li><a href="'+G.bindUrl(t)+'" rel="nofollow" class="ds-service-link ds-'+t+'">'+T.serviceNames[t],ie.data.social_uid[t]&&(i+=' <span class="ds-icon ds-icon-ok"></span>'),i+="</a></li>";return i},X.serviceList=function(e){var t,s,a,i="",r=e;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+='<li><a href="'+G.loginUrl(t)+'" rel="nofollow" class="ds-service-link ds-'+t+'">'+T.serviceNames[t]+"</a></li>";return i},X.shareWidget=function(e){var t,s,a,i='<div class="ds-share-icons"> <div class="ds-share-icons-inner"> <ul class="ds-share-icons-16"> ',r=e.services;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+=' <li> <a class="ds-'+t+'" href="javascript:void(0);" data-service="'+t+'">'+T.sourceName[t]+"</a> </li> ";return i+=' </ul> </div> <div class="ds-share-icons-footer">'+e.copyright+"</div></div>"},X.smiliesTooltip=function(e){var t,s='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';for(t in e)s+="<li><a>"+t+"</a></li>";return s+='</ul><div class="ds-smilies-container"></div></div>'},X.toolbar=function(){var e='<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>帐号管理</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">绑定更多</a></li><li><a target="_blank" href="'+T.REMOTE+"/settings/"+_(w())+'">'+d(M.settings)+'</a></li><li><a rel="nofollow" href="'+G.logoutUrl()+'" style="border-bottom: none">登出</a></li></ul></div><div class="ds-visitor">';return e+=ie.data.url?'<a class="ds-visitor-name" href="'+d(ie.data.url)+'" target="_blank">'+d(ie.data.name)+"</a>":'<span class="ds-visitor-name">'+d(ie.data.name)+"</span>",e+='<a class="ds-unread-comments-count" href="javascript:void(0);" title="新回复"></a></div></div>'},X.topThreads=function(e){var t,s,a,i="",r=e.response;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+='<li><a target="_blank" href="'+d(t.url)+'" title="'+d(t.title)+'">'+d(t.title)+"</a></li>";return i},X.topUsers=function(e){var t,s,a,i="",r=e.response;if(r)for(s=-1,a=r.length-1;a>s;)t=r[s+=1],i+='<div class="ds-avatar">'+X.avatar(t,e.options.avatar_size)+"<h4>"+d(t.name)+"</h4></div>";return i},X.userInfo=function(e){var t,s='<a href="'+d(e.url)+'" onclick="this.href=\''+a()+"/user-url/?user_id="+e.user_id+'\';" class="ds-avatar" target="_blank">'+X.avatarImg(e)+'</a><a href="'+d(e.url)+'" onclick="this.href=\''+a()+"/user-url/?user_id="+e.user_id+'\';" class="ds-user-name ds-highlight" target="_blank">'+d(e.name)+"</a>";for(t in e.social_uid)s+='<a href="'+T.REMOTE+"/user-proxy/"+t+"/"+e.social_uid[t]+'/" target="_blank" class="ds-service-icon ds-'+t+'" title="'+T.sourceName[t]+'"></a>';return s+='<p class="ds-user-card-meta"><a href="'+T.REMOTE+"/profile/"+e.user_id+'/" target="_blank"><span class="ds-highlight">'+e.comments+"</span>条评论</a></p>",e.description&&(s+='<p class="ds-user-description">'+d(e.description)+"</p>"),s},ee=T.Views={},T.Callbacks={},te=T.pagelets=[],se=T.events=new B,ae=T.site=new J,ie=T.visitor=new V,re=T.unread=new J,ne=T.threadPool=new F($),oe=T.postPool=new F(Q),de=T.userPool=new F(V),se.on("queryDefined",function(){var e,t,s=o.short_name;o.theme&&n(o.theme),p&&(e=p["ds_site_"+s],t=p["ds_lang_"+s],e&&ae.reset(l.parse(e)),t&&le.extend(M,l.parse(t)))}),k(),T.require("embed.compat",function(){function i(e){e.stopPropagation()}function n(e){(e.ctrlKey&&13==e.which||10==e.which)&&K(this.form).trigger("submit")}function d(){var e=K(this);e.height(Math.max(54,e.next(".ds-hidden-text").text(this.value).height()+27))}function l(){if(S.authInWin){var e=this.href.match(/\/(login|bind)\/(\w+)\//i);if(e&&T.serviceNames[e[2]])return!y(e[2],this.href)}}function u(){var e,s,a,i,r,n=this,o=0,d=0;t.selection&&(s=t.selection.createRange(),s&&s.parentElement()==n&&(i=n.value.length,e=n.value.replace(/\r\n/g,"\n"),a=n.createTextRange(),a.moveToBookmark(s.getBookmark()),r=n.createTextRange(),r.collapse(!1),a.compareEndPoints("StartToEnd",r)>-1?o=d=i:(o=-a.moveStart("character",-i),o+=e.slice(0,o).split("\n").length-1,a.compareEndPoints("EndToEnd",r)>-1?d=i:(d=-a.moveEnd("character",-i),d+=e.slice(0,d).split("\n").length-1)))),
K(n).data("ds-range-start",o).data("ds-range-end",d)}function f(e){return S.touch&&e.addClass("ds-touch"),le.cssProperty("transition")||e.addClass("ds-no-transition"),S.ie6&&e.addClass("ds-ie6"),S.opacity||e.addClass("ds-no-opacity"),e}function m(e){if(!S.placeholder){var t=e.attr("placeholder");e.val(t).focus(function(){this.value===t&&(this.value="")}).blur(function(){""===this.value&&(this.value=t)})}return e}function v(e){if("http://duoshuo.com"===e.origin)switch(e.data.type){case"login":c.href=e.data.redirectUrl}}function y(t,s){var a={weibo:[760,600],qq:[504,445],weixin:[450,550],google:[600,440]}[t]||[550,400];return e.open(s+(-1==s.indexOf("?")?"?":"&")+le.param({origin:c.origin||"http://"+c.host}),"_blank","width="+a[0]+",height="+a[1]+",toolbar=no,menubar=no,location=yes")}function _(e){var t=G[r()?"loginUrl":"bindUrl"](e);S.authInWin&&y(e,t)||(c.href=t)}function w(){var e=P(X["dialog-ask-for-auth"]({})).el.find(".ds-dialog").css("width","300px");e.find("a.ds-service-link").click(l)}function j(e,t,s,a){function i(){function e(e){var t,i,r;s&&a&&(t=s.options,i=A(s.postList.el,e.response[a],t),"asc"==t.order==("top"==t.formPosition)&&T.scrollTo(i),r=s.el.find(".ds-comments-tab-"+a+" span.ds-highlight"),r.html(parseInt(r.html())+1))}return a||l.find("[type=checkbox]:checked")[0]?(N.post("posts/repost",T.toJSON(l),e),o.close(),!1):(alert("还没有选发布到哪儿"),!1)}function r(){var e=this.value;return this.checked&&!ie.data.social_uid["qqt"==e?"qq":e]?void _(e):void 0}var o=P(X["dialog-reposts"]({post:e.toJSON(),repostMessage:t,service:a})),l=o.el.find("form");return l.submit(i),l.find(".ds-actions [type=checkbox]").change(r),m(l.find("textarea")).keyup(n).keyup(d).focus(),!1}function E(e){var t,s={"unread-comments":{title:"新消息",apiUrl:"users/unreadComments",tmpl:function(e){return e.thread?'<li data-thread-id="'+e.thread.thread_id+'">'+K.map(e.authors,X.userAnchor).join("、")+' 在 <a class="ds-read" href="'+e.thread.url+'#comments" target="_blank">'+g(e.thread.title||"无标题")+'</a> 中回复了你 <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>':""},read:function(e){var t=e.attr("data-thread-id");N.post("threads/read",{thread_id:t}),re.data.comments--}},"unread-notifications":{title:"系统消息",apiUrl:"users/unreadNotifications",tmpl:function(e){return'<li data-notification-id="'+e.notification_id+'" data-notification-type="'+e.type+'">'+e.content+' <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>'},read:function(e){var t=e.attr("data-notification-id");N.post("notifications/read",{notification_id:t}),re.data.notifications--}}}[e],a=P("<h2>"+s.title+'</h2><ul class="ds-unread-list"></ul>');a.on("close",T.resetNotify),t=a.el.find(".ds-unread-list").delegate(".ds-delete","click",function(){return K(this).parent().remove(),0===t.children().length&&a.close(),!1}).delegate(".ds-read","click",function(){s.read(K(this).parent())}),K("#ds-notify").hide(),N.get(s.apiUrl,{},function(e){a.el.find(".ds-unread-list").html(K.map(e.response,s.tmpl).join("\n"))})}function L(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}function R(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0,J.detach()},400)}function A(e,t,s){return e.find(".ds-post[data-post-id="+t.data.post_id+"]")[0]?void 0:(e.find(".ds-post-placeholder").remove(),K(X.post({post:t.toJSON(),options:s})).hide()["asc"==s.order?"appendTo":"prependTo"](e).slideDown(function(){}))}function z(e,t){function s(){if(r())return w(),!1;var e=K(this).parent(),t=e.hasClass("ds-post-liked"),s=K(this).html().match(/\((\d+)\)/),a=(s?parseInt(s[1]):0)+(t?-1:1);return N.post("posts/vote",{post_id:e.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:t?0:1}),K(this).html(K(this).html().replace(/\(\d+\)/,"")+(a?"("+a+")":"")),e[t?"removeClass":"addClass"]("ds-post-liked"),!1}function a(){var e=K(this).closest(".ds-post-self"),t=oe[e.attr("data-post-id")];return j(t,""),!1}function i(){if(!confirm("确定删除？"))return!1;var t=K(this).closest(".ds-post-self");return N.post("posts/remove",{post_id:t.attr("data-post-id")}),t.parent().fadeOut(200,function(){e.data.comments--,e.updateCounter("duoshuo"),K(this).remove()}),!1}function n(){if(!confirm("确定举报？"))return!1;var e=K(this).closest(".ds-post-self");return N.post("posts/report",{post_id:e.attr("data-post-id")}),alert("感谢反馈！"),!1}function o(){var s,a=K(this),i=a.closest(".ds-comment-actions");return i.hasClass("ds-reply-active")?(h.el.fadeOut(200,function(){K(this).detach()}),i.removeClass("ds-reply-active")):(s=a.closest(".ds-ctx-entry, .ds-post-self"),h?h.actionsBar.removeClass("ds-reply-active"):(h=new ee.Replybox(e),h.render(!0).el.addClass("ds-inline-replybox").detach()),h.el.find("[name=parent_id]").val(s.attr("data-post-id")),h.el.show().appendTo(a.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus(),h.actionsBar=i.addClass("ds-reply-active"),t.max_depth<=1?h.postList=e.postList.el:(h.postList=s.siblings(".ds-children"),h.postList[0]||(h.postList=K('<ul class="ds-children"></ul>').insertAfter(s)))),!1}function d(){function e(e){D(e),s.append(K.map(e.response,function(e){return X.post({post:e,options:t})}).join(""))}var s,a=K(this).closest(".ds-post-self"),i=a.attr("data-post-id");return a.data("source"),0==a.attr("data-root-id")&&(s=a.siblings(".ds-children"),s[0]?(s.remove(),!1):(s=K('<ul class="ds-children"></ul>').insertAfter(a),N.get("posts/listComments",W({post_id:i}),e),!1))}function l(){var t,s,a,i,r=K(this).closest(".ds-post-self"),n=oe[r.attr("data-post-id")],o=n.data.source;return ie.data.social_uid["qqt"==o?"qq":o]?(t=n.data.root_id,s="0"!=t?oe[t]:n,a="","0"!=t&&(i=prepatePost(n.data).theAuthor,a=("weibo"==o?"//@"+i.name:"|| @"+i.qqt_account)+":"+n.data.message),j(s,a,e,o),!1):void _(o)}function c(){var e=K(this).parent();return e.siblings().show(),e.remove(),!1}function u(){function t(){function t(e){var t=e.response;de[c]?de[c].set(t):de[c]=new V(t),J.owner==a&&F.html(X.userInfo(t))}var i,r,n,o,d,l,c;Y=0,J.owner=a,L(),i=s.offset(),r=e.el.offset(),n=s.innerWidth()/2,o=e.el.innerHeight()-(i.top-r.top)+6,d=i.left-r.left-35+(n>35?35:n);try{if(s.hasClass("ds-comment-context"))F.attr("id","ds-ctx-bubble").attr("data-post-id",s.attr("data-post-id")).html('<ul id="ds-ctx">'+X.ctxPost({post:oe[s.attr("data-parent-id")].toJSON()})+'</ul><div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">查看对话</a></div>');else if(s.hasClass("ds-avatar")||s.hasClass("ds-user-name")){if(l={},c=l.user_id=s.attr("data-user-id"),!c)throw"no info";F.attr("id","ds-user-card").attr("data-user-id",c).empty(),de[c]?F.html(X.userInfo(de[c].data)):N.get("users/profile",W(l),t)}J.css({bottom:o,left:d}).appendTo(e.innerEl)}catch(e){J.detach()}}var s,a=this;return bubbleOutTimer&&J.owner==a?(clearTimeout(bubbleOutTimer),void(bubbleOutTimer=0)):(s=K(a),void(Y=setTimeout(t,200)))}function p(){Y?(clearTimeout(Y),Y=0):bubbleOutTimer||R()}var h;this.delegate("a.ds-post-likes","click",s).delegate("a.ds-post-repost","click",a).delegate("a.ds-post-delete","click",i).delegate("a.ds-post-report","click",n).delegate("a.ds-post-reply","click",o).delegate("a.ds-weibo-comments","click",d).delegate("a.ds-weibo-reposts","click",l).delegate("a.ds-expand","click",c),S.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",u).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",p)}function W(e){var s,a={require:"site,visitor,nonce,lang"+(Z++?"":",unread,log,extraCss"),site_ims:U.get("ds_site_"+o.short_name+":timestamp"),lang_ims:U.get("ds_lang_"+o.short_name+":timestamp"),referer:t.referrer};o.stylePatch&&(a.style_patch=o.stylePatch);for(s in a)a[s]&&(!S.ie6||encodeURIComponent(a[s]).length<200)&&(e[s]=a[s]);return e}var J,F,Y,Z,K=T.jQuery,se=K(e),ce=K(t);e.postMessage&&(e.addEventListener?e.addEventListener("message",v,!1):e.attachEvent&&e.attachEvent("onmessage",v)),T.scrollTo=function(e){var t=e.offset().top;(t<se.scrollTop()||t>se.scrollTop()+se.height())&&K("html, body").animate({scrollTop:t-40},200,"swing")},T.toJSON=function(e){var t=/\r?\n/g,s=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,a=/^(?:select|textarea)/i,i=e.map(function(){return this.elements?K.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||a.test(this.nodeName)||s.test(this.type))}).map(function(e,s){var a=K(this).val();return null==a?null:K.isArray(a)?K.map(a,function(e){return{name:s.name,value:e.replace(t,"\r\n")}}):{name:s.name,value:a.replace(t,"\r\n")}}).toArray(),r={};return K.each(i,function(){r[this.name]=this.value}),r},T.resetNotify=function(){var e=K("#ds-notify"),s=re.data;e[0]||(e=K('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[ae.data.notify_position]).delegate(".ds-notify-unread a","click",function(){return E(K(this).data("type")),!1}).appendTo(t.body)),e.html(X.notify(s))[!s.comments&&!s.notifications||"hidden"===ae.data.notify_position||K(".ds-dialog")[0]?"hide":"show"]()},re.on("reset",T.resetNotify),ee.Replybox=function(e){this.embedThread=e},ee.Replybox.prototype={render:function(e){function s(e){e.data("submitting",!0),e.find(".ds-post-button").addClass("ds-waiting").html(M.posting)[0].disabled=!0}function a(e){e.data("submitting",!1),e.find(".ds-post-button").removeClass("ds-waiting").html(M.post)[0].disabled=!1}var i,o,c,h,f,v,g,b,y,_,w,k,x=this,C=x.embedThread,j=C.options,q=function(){T.require("smilies",function(){})},O={thread:C,options:j,inline:e,params:{thread_id:C.threadId,parent_id:"",nonce:T.nonce},repostArray:[],checked:0};for(i in ie.data.repostOptions)ie.data.repostOptions[i]&&(O.repostArray.push(i),O.checked=1);return o=x.el=K(X.replybox(O)).click(q),c=o.find("form"),h=c.find("input[type=checkbox]")[0],f=c.find("a.ds-service-icon, a.ds-service-icon-grey"),v=m(c.find("textarea")).focus(q).keyup(n).keyup(d).bind("focus mousedown mouseup keyup",u),g=o.find(".ds-add-emote").click(function(e){var s=T.smiliesTooltip;return g.toggleClass("ds-expanded").hasClass("ds-expanded")?(s||(s=T.smiliesTooltip=new ee.SmiliesTooltip,s.render(),T.require("smilies",function(){s.reset("微博-默认")})),s.replybox=x,s.el.appendTo(t.body).css({top:x.el.offset().top+x.el.outerHeight()+4+"px",left:x.el.find(".ds-textarea-wrapper").offset().left+"px"}),K(t.body).click(b)):b(e),!1}),o.find(".ds-add-image").click(function(e){var s,a,i=v[0],r=i.value,n="请输入图片地址",o='<img src="'+n+'" />';t.selection?(i.value=r.substring(0,v.data("ds-range-start"))+o+r.substring(v.data("ds-range-end"),r.length),i.focus(),s=t.selection.createRange(),s.collapse(),s.findText(n),s.select()):(i.value=r.substring(0,i.selectionStart)+o+r.substring(i.selectionEnd),a=i.value.search(n),i.setSelectionRange(a,a+n.length),i.focus()),e.preventDefault()}),b=x.hideSmilies=function(){g.removeClass("ds-expanded"),T.smiliesTooltip.el.detach(),K(t.body).unbind("click",b)},y=function(e,t){var s,a=P(X["dialog-anonymous"]({services:["weixin","weibo","qq"],options:j})),i=a.el.find(".ds-dialog").css("width","320px");i.find(".ds-icons-32 a").click(l),j.deny_anonymous||(s=a.el.find("form"),s.submit(function(){var e=s.find("input[name=author_email]").val();return!e&&!j.require_guest_email||e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(t(T.toJSON(s)),a.close(),!1):(alert("email无效."),!1)}),s.find("input[name=author_name]")[0].focus())},j.deny_anonymous&&v.focus(function(){if(r()){y(c,_);var e=function(t){t.stopPropagation(),v.unbind("click",e)};v.click(e)}return!1}),_=function(e){s(c),N.post("posts/create",K.extend(T.toJSON(c),e),function(e){var t=oe[e.response.post_id]=new Q(e.response),s=A(x.postList,t,j);if("asc"==j.order==("top"==j.formPosition)&&T.scrollTo(s),C.data.comments++,C.updateCounter("duoshuo"),v.val("").trigger("keyup"),a(c),o.hasClass("ds-inline-replybox")&&(o.detach(),x.actionsBar.removeClass("ds-reply-active")),p)try{p.removeItem("ds_draft_"+C.threadId)}catch(e){}},function(e){a(c),alert(e.errorMessage)})},c.submit(function(){if(c.data("submitting"))return!1;var e=K.trim(c[0].message.value);return""==e||!S.placeholder&&e==v.attr("placeholder")?(alert("您还没写内容呢"),!1):(r()?y(c,_):_(),!1)}),w=function(e){return K(e).hasClass("ds-service-icon-grey")?null:K(e).attr("data-service")},f.click(function(){return K(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),h.value=K.map(f,w).join(","),h.checked=""!=h.value,!1}),K(h).change(function(){var e=this.checked;f[e?"removeClass":"addClass"]("ds-service-icon-grey")[e?"addClass":"removeClass"]("ds-service-icon"),this.value=K.map(f,w).join(",")}),!e&&p&&(k="ds_draft_"+C.threadId,v.bind("focus blur keyup",function(e){var t=K(e.currentTarget).val();try{p[k]=t}catch(e){}}),p[k]&&v.val(p[k])),this}},ee.Dialog=B.extend({init:function(e,t){(this.el=K("#ds-wrapper"))[0]||(this.el=f(K('<div id="ds-wrapper"></div>'))),this.options=K.extend({width:600},t),e!==s&&K(e).attr("id","ds-reset").appendTo(this.el)},open:function(){function e(e){return 27==e.which?(a.close(),!1):void 0}function s(){return a.close(),!1}var a=this;return a.el.hide().appendTo(t.body).fadeIn(200),S.ie6&&a.el.css("top",se.scrollTop()+100),a.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(){return a.close(),!1}).click(i),ce.keydown(e),K(t.body).click(s),a.close=function(){ce.unbind("keydown",e),K(t.body).unbind("click",s),a.el.fadeOut(200,function(){K(this).remove()}),a.trigger("close")},a}}),X.likePanel=function(e){return e.likes?'<span class="ds-highlight">'+e.likes+"</span> 人喜欢":""},ee.Meta=function(e){this.embedThread=e},ee.Meta.prototype={render:function(){function a(a){function r(e){o.set(e),n.resetLikePanel()}function c(){n.tooltip.detach(),K(t.body).unbind("click",c)}function u(t){switch(this.className){case"ds-like-tooltip-close":c(t);break;default:if(!e.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no"))return}return!1}var p,h,f=l.hasClass("ds-thread-liked");return N.post("threads/vote",{thread_id:n.embedThread.threadId,vote:f?0:1},r),l.toggleClass("ds-thread-liked"),l.find(".ds-thread-like-text").text(f?"喜欢":"已喜欢"),f?(n.tooltip&&c(a),!1):(n.tooltip===s&&(p=X.likeTooltip({services:{weibo:"新浪微博"},thread_id:o.data.thread_id}),n.tooltip=K(p).click(i).delegate("a","click",u)),h={},h.left=0,h.top=d.position().top+d.outerHeight()-4+"px",n.tooltip.appendTo(n.embedThread.innerEl).css(h),K(t.body).click(c),!1)}var n=this,o=n.embedThread.model,d=n.el=K(X.meta(o.toJSON())),l=d.find(".ds-like-thread-button");return l.click(a),n.resetLikePanel(),r()&&d.hide(),n},resetLikePanel:function(){this.el.find(".ds-like-panel").html(X.likePanel(this.embedThread.model.toJSON()))}},ee.PostListHead=function(e){this.embedThread=e},ee.PostListHead.prototype={render:function(){function e(e){n.find("a.ds-current").removeClass("ds-current"),i.params.page=1;var t=e.currentTarget;switch(t.className){case"ds-comments-tab-duoshuo":i.params.source="duoshuo",a.replybox.el.show();break;case"ds-comments-tab-repost":i.params.source="repost",a.replybox.el.hide();break;case"ds-comments-tab-weibo":i.params.source="weibo",a.replybox.el.hide()}return K(t).addClass("ds-current"),i.refetch(),!1}function t(){return s.find("a.ds-current").removeClass("ds-current"),i.params.order=a.options.order=this.className.replace("ds-order-",""),i.params.page=1,i.refetch(),K(this).addClass("ds-current"),!1}var s,a=this.embedThread,i=a.postList,r=this.el=K(X.postListHead({thread:a.model.toJSON(),options:a.options})),n=r.find("ul.ds-comments-tabs");return n.delegate(".ds-tab a","click",e),s=r.find(".ds-sort"),s.delegate("a","click",t),s.find(".ds-order-"+i.params.order).addClass("ds-current"),this}},ee.Paginator=function(e){function t(){return i.params.page=parseInt(this.innerHTML),i.refetch(),a.find(".ds-current").removeClass("ds-current"),K(this).addClass("ds-current"),!1}e=e||{};var s=this,a=s.el=e.el||K('<div class="ds-paginator"></div>'),i=s.collection=e.collection;a.delegate("a","click",t)},ee.Paginator.prototype={reset:function(e){function t(e){i.push('<a data-page="'+e+'" href="javascript:void(0);">'+e+"</a>")}var s,a=this.collection.params.page||1,i=[];if(a>1)for(t(1),s=a>4?a-2:2,s>2&&i.push('<span class="page-break">...</span>');a>s;s++)t(s);if(i.push('<a data-page="'+a+'" href="javascript:void(0);" class="ds-current">'+a+"</a>"),a<e.pages){for(s=a+1;a+4>=s&&s<e.pages;s++)t(s);s<e.pages&&i.push('<span class="page-break">...</span>'),t(e.pages)}this.el.html('<div class="ds-border"></div>'+i.join(" "))[e.pages>1?"show":"hide"]()}},T.addSmilies=function(e,t){var s=T.smiliesTooltip;s&&s.el.find("ul.ds-smilies-tabs").append("<li><a>"+e+"</a></li>"),T.smilies[e]=t},ee.SmiliesTooltip=function(){},ee.SmiliesTooltip.prototype={render:function(){function e(){var e,a,i=s.replybox,r=i.el.find("textarea"),n=r[0],o=n.value;t.selection?(n.value=o.substring(0,r.data("ds-range-start"))+this.title+o.substring(r.data("ds-range-end"),o.length),n.value=n.value.replace(M.leave_a_message,""),n.focus(),e=t.selection.createRange(),e.moveStart("character",r.data("ds-range-start")+this.title.length),e.collapse(),e.select()):(a=n.selectionStart+this.title.length,n.value=o.substring(0,n.selectionStart)+this.title+o.substring(n.selectionEnd),n.setSelectionRange(a,a)),i.hideSmilies(),n.focus()}var s=this,a=s.el=K(X.smiliesTooltip(O));return a.click(i).find("ul.ds-smilies-tabs").delegate("a","click",function(){s.reset(this.innerHTML)}),a.find(".ds-smilies-container").delegate("img","click",e),this},reset:function(e){function t(t,a){var i=0===e.indexOf("微博")?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+a.replace("_org","_thumb"):T.STATIC_URL+"/images/smilies/"+a;"WordPress"===e&&(t=" "+t+" "),s+='<li><img src="'+i+'" title="'+g(t)+'" /></li>'}var s,a=this.el.find("ul.ds-smilies-tabs");return a.find("a.ds-current").removeClass("ds-current"),a.find("a").filter(function(){return this.innerHTML==e}).addClass("ds-current"),s="<ul>",K.each(O[e],t),s+="</ul>",this.el.find(".ds-smilies-container").html(s),this}},X.postPlaceholder=function(){return['<li class="ds-post ds-post-placeholder">',M.no_comments_yet,"</li>"].join("")},J=K('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),F=J.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(){function e(e){function s(e,t){return X.ctxPost({post:e,index:t})}x.log(K.map(e.response,s).join("\n")),t.el.find("ol"),t.el.find("ol").html(K.map(e.response,s).join("\n"))}var t,s={};return s.post_id=F.attr("data-post-id"),N.get("posts/conversation",s,e),t=P('<h2>查看对话</h2><ol id="ds-ctx"></ol>'),t.el.find(".ds-dialog").css("width","600px"),t.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px","overflow-y":"auto","padding-top":"10px"}),!1}),Y=bubbleOutTimer=0,J.mouseenter(L).mouseleave(R),ee.PostList=function(e){e&&(e.params&&(this.params=e.params),e.embedThread&&(this.embedThread=e.embedThread)),this.el=K('<ul class="ds-comments"></ul>')},ee.PostList.prototype={url:"threads/listPosts",render:function(){return z.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(e){var t=this.embedThread.options;this.el.html(e[0]?K.map(oe.getJSON(e),function(e){return X.post({post:e,options:t})}).join(""):X.postPlaceholder())},refetch:function(){function e(e){oe.set(e.parentPosts||e.relatedPosts),de.set(e.users),s.reset(e.response),s.embedThread.paginator.reset(e.cursor),s.el.fadeTo(200,1),T.scrollTo(s.el),a.remove()}var s=this,a=K(X.indicator()).appendTo(t.body).fadeIn(200);s.el.fadeTo(200,.5),N.get(s.url,s.params,e)}},ee.RelatedRead=function(){this._init()},ee.RelatedRead.prototype={_init:function(){this.el=K('<div id="ds-related-reads"></div>')},load:function(s){e.__duoshuo_id__=s,e.readsByToutiao=[],e.readsByToutiao.push({id:"ds-related-reads",num:3});var a="//s0.pstatp.com/site/reads-sdk/5bf3702b38076207bee1.js",i=t.createElement("script");i.src=a,i.charset="utf-8",i.crossOrigin="anonymous",t.head.appendChild(i)},mount:function(e){this.el.insertBefore(e)}},ee.EmbedThread=H.extend({uri:"threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(h.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){var e,t,s=this.el;return"此处替换成文章ID"===s.data("thread-key")?(alert("err1450"),!1):(s.attr("id","ds-thread").append(X.waitingImg()),e=s.width(),t=s.data("url")||!s.attr("data-thread-id")&&K("link[rel=canonical]").attr("href"),t?s.data("url",b(t)):s.data("container-url",c.href),void(e&&400>=e&&s.addClass("ds-narrow").data("max-depth",1)))},updateCounter:function(e){function t(e){return e.substr(e.indexOf("}")+1)}var s,a,i={duoshuo:["comments",t(M.comments_multiple)||"评论"],repost:["reposts",t(M.reposts_multiple)||"转载"],weibo:["weibo_reposts",t(M.weibo_reposts_multiple)||"新浪微博"]};for(s in i)e&&e!=s||(a=this.data[i[s][0]],this.el.find(".ds-comments-tab-"+s).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+s+'"></span>'+a:(a?'<span class="ds-highlight">'+a+"</span>":"0")+i[s][1]))},onError:function(e){this.el.html(e.code+": "+e.errorMessage)},onload:function(t){var a,i,n=this,o=n.threadId=t.thread.thread_id,d=t.cursor,c=n.options=t.options,u=n.innerEl=f(K('<div id="ds-reset"></div>').appendTo(n.el));n.model=new $(n.data=t.thread),oe.set(t.parentPosts||t.relatedPosts),de.set(t.users),n.el.find("#ds-waiting").remove(),t.options&&t.options.show_recommend&&(n.relatedRead=new ee.RelatedRead,n.relatedRead.load(t.thread.site_id),n.relatedRead.mount(u)),c.like_thread_enabled&&(n.meta=new ee.Meta(n),u.append(n.meta.render().el)),c.hot_posts&&t.hotPosts&&t.hotPosts.length&&(n.hotPosts=new ee.HotPosts(K('<div class="ds-rounded"></div>'),{max_depth:1,show_context:c.show_context}),n.hotPosts.thread=n,u.append(n.hotPosts.el),n.hotPosts.onload({list:oe.getJSON(t.hotPosts)})),n.postListHead=new ee.PostListHead(n),n.postList=new ee.PostList({embedThread:n,params:{source:"duoshuo",thread_id:o,max_depth:c.max_depth,order:c.order,limit:c.limit}}),n.postList.render().reset(t.response),n.paginator=new ee.Paginator({collection:n.postList}),n.paginator.reset(d),a=n.replybox=new ee.Replybox(n),a.postList=n.postList.el,r()?n.loginButtons=K(X.loginButtons()).delegate("a.ds-more-services","click",function(){return n.loginButtons.find(".ds-additional-services").toggle(),!1}).delegate("a.ds-service-link","click",l):n.toolbar=K(X.toolbar()).delegate(".ds-account-control","mouseenter",function(){K(this).addClass("ds-active")}).delegate(".ds-account-control","mouseleave",function(){K(this).removeClass("ds-active")}).delegate("a.ds-bind-more","click",function(){var e=P(X["dialog-bind-more"]()).el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px");return e.find("a.ds-service-link").click(l),!1}).delegate("a.ds-unread-comments-count","click",function(){return E("unread-comments"),!1}),i=['<a name="respond"></a>',n.toolbar||n.loginButtons,a.render().el],"top"==c.formPosition&&K.fn.append.apply(u,i),u.append(n.postListHead.render().el,n.postList.el,n.paginator.el),"bottom"==c.formPosition&&K.fn.append.apply(u,i),u.append(X.poweredBy(c.poweredby_text)),n.updateCounter(),t.alerts&&K.each(t.alerts,function(e,t){K('<div class="ds-alert">'+t+"</div>").insertBefore(n.toolbar||loginButtons)}),c.message&&a.el.find("textarea").val(c.message).focus(),re.on("reset",function(){var e=re.data.comments||0;u.find("a.ds-unread-comments-count").html(e).attr("title",e?"你有"+e+"条新回复":"没有新回复").css("display",e?"inline":"none")}),c.mzadx_id&&(T.require("mzadxN",function(){}),K('<div id="MZADX_'+c.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(u),__mz_rpq=e.__mz_rpq||[],__mz_rpq.push({l:[c.mzadx_id],r:"1",_srv:"MZADX",_callback:function(){}})),T.thread=n,re.data!==s&&re.trigger("reset"),r()||I.send({visit_thread_id:n.threadId})},onMessage:function(e){A(this.postList.el,new Q(e),this.options)}}),ee.HotPosts=H.extend({tmpl:"hotPosts",params:"show-quote",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(e){e.options=K.extend(this.options,e.options),H.prototype.onload.call(this,e),z.call(this.el.find("ul"),this.thread,this.options)}}),ee.RecentComments=H.extend({tmpl:"commentList",uri:"sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",render:function(){this.el.attr("id","ds-recent-comments")},prepare:function(e){return{list:K.map(e.response,function(e){return new Q(e).toJSON()})}}}),ee.RecentVisitors=H.extend({tmpl:"recentVisitors",uri:"sites/listVisitors",params:"show-time avatar-size num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-recent-visitors").append(this.waitingEl=K(X.waitingImg()))}}),ee.TopThreads=H.extend({tmpl:"topThreads",uri:"sites/listTopThreads",params:"range num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-threads").append(this.waitingEl=K(X.waitingImg()))}}),ee.LoginWidget=H.extend({tmpl:"loginWidget",render:function(){var e=this.el;e.attr("id","ds-login").html(X.loginWidget(["weixin","weibo","qq"])),e.find("a").click(l),e.find("a.ds-logout").attr("href",G.logoutUrl())}}),ee.ThreadCount=H.extend({onload:function(e){var t=this.el,s=t.data("count-type")||"comments",a=e.data[s];t[t.data("replace")?"replaceWith":"html"](M[s+"_"+(a?a>1?"multiple":"one":"zero")].replace("{num}",a))}}),ee.ShareWidget=H.extend({tmpl:"shareWidget",render:function(){var e={copyright:"多说",services:["weibo","qq","google","wechat","facebook","twitter","linkedin"]};this.el.attr("id","ds-share"),this.el.children().attr("id","ds-reset"),this.el.find(".ds-share-aside-inner").html(X.shareWidget(e)),this.el.find(".ds-share-icons-more").html(X.shareWidget(e)),this.el.find(".ds-share-icons-more").hide(),this.el.hasClass("flat")&&this.el.find("a").each(function(){K(this).addClass("flat")}),f(this.el),this.delegateEvents()},delegateEvents:function(){var s,i,r,n,o,d,l=this,c=l.el;c.children().hasClass("ds-share-inline")?(s=".ds-share-icons-more",i=c.find(s),r="[data-toggle=ds-share-icons-more]",c.delegate(r,"mouseover",function(){i.show()}),c.delegate(r,"mouseout",function(){i.hide()}),c.delegate(s,"mouseover",function(){i.show()}),c.delegate(s,"mouseout",function(){i.hide()})):(n=c.children().hasClass("ds-share-aside-left")?"slide-to-right":"slide-to-left",o=c.children(),le.cssProperty("transition")||(d=c.children().hasClass("ds-share-aside-left")?"left":"right",c.delegate(".ds-share-aside-toggle","mouseover",function(){var e={},s=S.ie6&&"right"===d;s?e.left=(t.documentElement.scrollLeft+t.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)-195:e[d]=0,o.animate(e,200)}),c.delegate(".ds-share-aside-inner","mouseleave",function(){var e={},s=S.ie6&&"right"===d;s?e.left=(t.documentElement.scrollLeft+t.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)+230:e[d]=-229,o.animate(e,200)})),c.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseover",function(){o.addClass(n)}),c.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseleave",function(){o.removeClass(n)})),c.delegate("a","click",function(t){var s,i,r,n,o=K(this).data("service");return c.data("url")?("wechat"===o?(s=a()+"/api/qrcode/getImage.png",i="?size=240&text="+c.data("url"),r=P(X["dialog-qrcode"]({qrcode_url:s+i,url:c.data("url")})),r.el.find(".ds-dialog").css("width","320px")):(n=a()+"/share-proxy/?"+le.param({service:K(this).data("service"),thread_key:c.data("threadKey"),title:c.data("title"),images:c.data("images"),content:c.data("content"),url:c.data("url")}),e.open(n,"_blank")),t.preventDefault(),void t.stopPropagation()):void alert("请设置data-url")})}}),Z=0,T.initSelector=function(e,t){function s(e){D(e),le.extend(M,e.options),ne.set(e.response)}var a=[];!k()||!K.isReady&&C||K(e).each(function(e,s){var i,r,n,o=K(s);o.data("initialized")||(o.data("initialized",!0),i=new ee[t.type](o,t),te.push(i),"ThreadCount"===t.type?(r=o.attr("data-thread-key"),o.attr("data-channel-key")&&(r=o.attr("data-channel-key")+":"+r),a.push(r),ne[r]||(ne[r]=new $({})),ne[r].on("reset",function(){i.onload(this)})):i.uri&&(n={},K.each(i.params.split(" "),function(e,t){n[t.replace(/-/g,"_")]=o.attr("data-"+t)||o.data(t)}),N.get(i.uri,W(n),function(e){i.load(e)})))}),a.length&&N.get("threads/counts",W({threads:a.join(",")}),s)},(T.initView=function(){K.each(q,T.initSelector)})(),K(function(){if(!o){if(!k())return x.error("err1684");x.warn("err1685")}setInterval(function(){K(".ds-time").each(function(){var e=K(this).attr("datetime");e&&(this.innerHTML=T.elapsedTime(e))})},2e4),o.ondomready&&o.ondomready(),T.initView(),!Z&&o.short_name&&N.get("analytics/ping",W({}),D)})})}}(window,document);